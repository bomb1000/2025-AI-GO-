**README: 飆股預測競賽進度紀錄**

---

## 一、專案背景
- 目標：以 AI 技術預測台灣股市中的「飆股」（二分類問題）。
- 資料集：訓練資料約 200,864 筆 × 10,214 欄。（Colab Pro 環境）

## 二、資料初探與驗證
1. **原始維度**：200,864 rows × 10,214 cols
2. **標籤分佈**：飆股＝1：1,470 筆（0.73%）；非飆股＝199,394 筆（99.27%）。
   - 高度不平衡，後續需分層切分與類別平衡處理。
3. **缺失值統計**：共 10,214 欄，總遺失值約 99,640 筆（約 9.8%）。
   - 15 欄位完全缺失（100%），已移除 → 10,199 欄剩餘。

## 三、缺失率分組策略
- **C 組（>50% 缺失）**：完全缺失 15 欄 → 已刪除。
- **B 組（20–50% 缺失）**：45 欄（如多日「外資券商_分點買賣力」、季報財務比率等）。
- **A 組（≤20% 缺失）**：10,154 欄。

## 四、A 組（≤20%）處理流程
1. **填補方式**：統一以「中位數填補」。
2. **檢查樣本統計**：
   ```text
   外資券商_分點進出        mean=1.223701, std=1.006672
   外資券商_分點成交力(%)    mean=1.221576, std=0.991976
   上市加權指數10天成交量波動度 mean=1.220654, std=1.000439
   上市加權指數20天成交量波動度 mean=1.220340, std=0.998958
   飆股                   mean=0.007318, std=0.085234
   ```
3. **結果**：分佈合理，確認保留所有 A 組特徵。

## 五、B 組（20–50%）評估與篩選
1. **相關性檢測**：計算這 45 欄與 `飆股` 的皮爾森絕對值，結果皆在 0.01–0.02，顯示幾乎無線性關聯。
2. **結論**：整批捨棄 B 組特徵。

## 六、後續特徵篩選
1. **移除 B 組後維度**：(200,864, 10,201)
2. **低變異過濾**：Threshold=0.01 → 0 欄位被移除。
3. **LightGBM 初步打分**：載入最終數據集後，訓練 100 棵樹，取 `gain` 排名前 20 名特徵：
   ```text
   1. 技術指標_RSI(5): 832.79
   2. 技術指標_乖離率(60日): 721.12
   3. 買超第3名分點前14天賣筆數: 613.54
   4. 外資券商_前2天分點進出: 412.01
   5. 買超第8名分點前12天賣均值(千): 316.37
   6. 買超第12名分點前3天賣均值(千): 298.91
   7. 個股5天乖離率: 266.12
   8. 上市加權指數前20天成交量: 265.29
   9. 上市加權指數前5天收盤價: 250.75
   10. 個股主力買賣超統計_近240日主力買賣超: 238.14
   11. 賣超第9名分點前1天買均張: 178.23
   12. 日投信_投信持股成本: 163.64
   13. 技術指標_月-DI(14): 160.65
   14. 買超第9名分點前6天賣筆數: 152.83
   15. 技術指標_季MACD: 152.74
   16. 個股券商分點區域分析_近1日買超3分點區域密度: 138.02
   17. 技術指標_月RSI(5): 133.02
   18. 賣超第10名分點前3天買均值(千): 125.20
   19. 買超第12名分點前6天賣均值(千): 110.24
   20. 賣超第11名分點前1天賣均值(千):  99.80
   ```
## 七、下一步：深度特徵工程與模型訓練
1. **深度特徵工程**：
   - **滾動統計量**：對成交量、收盤價及 top 20 特徵，計算 3/5/10/20 日的平均、標準差、最大–最小差、線性斜率。
   - **技術指標**：RSI (5,14)、MACD、訊號線、布林通道寬度、ATR、KDJ。
   - **交互特徵**：外資買賣力／投信買賣力、主力吃貨比−自營商吃貨比等比率與差分。
   - **回報**：請對同一支代表股票示範計算結果（滾動＆指標與交互）並檢查特徵欄位。
2. **建立時序分層 CV**：
   - **Purged Time-Series CV** + **Stratified Sampling**，確保過去→未來切分與正負例比例。
   - **回報**：貼出第一折 train/val 大小與飆股比例。
3. **基線模型訓練與評估**：
   - LightGBM（n=500, early_stopping=50, class_weight='balanced'），在每折計算 F1，輸出平均 F1＋標準差。
   - 最後一折掃描閾值（0.1–0.9），找最佳 F1、Precision/Recall。
   - **回報**：平均 CV F1、最佳閾值及對應 Precision/Recall。
4. **超參數優化與集成**：
   - 使用 Optuna/Skopt 進行超參數搜尋，優化 learning_rate、max_depth、num_leaves、feature_fraction、bagging_fraction。
   - 訓練多組模型對概率做加權平均，並輸出最終 CV F1。

---

**請依序從「深度特徵工程」開始，每完成一小題，即回報指定結果，然後再進行下一步。**

